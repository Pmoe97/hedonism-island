<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Crafting System Test - Hedonism Island</title>
  
  <!-- Load CSS -->
  <link rel="stylesheet" href="../src/styles/craftingUI.css">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
      color: #e0e0e0;
      min-height: 100vh;
      padding: 20px;
    }

    .test-container {
      max-width: 1400px;
      margin: 0 auto;
    }

    .test-header {
      background: rgba(26, 26, 46, 0.8);
      border: 2px solid #4dd0e1;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
    }

    .test-header h1 {
      color: #4dd0e1;
      margin-bottom: 10px;
    }

    .control-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .control-section {
      background: rgba(26, 26, 46, 0.8);
      border: 1px solid #4dd0e1;
      border-radius: 8px;
      padding: 15px;
    }

    .control-section h3 {
      color: #4dd0e1;
      margin-bottom: 15px;
      font-size: 16px;
      text-transform: uppercase;
    }

    .button-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button.success {
      background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
    }

    button.warning {
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    }

    .info-display {
      background: rgba(0, 0, 0, 0.3);
      border-left: 3px solid #4dd0e1;
      padding: 15px;
      margin-top: 10px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    .stat-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-top: 10px;
    }

    .stat-item {
      display: flex;
      justify-content: space-between;
      padding: 8px;
      background: rgba(77, 208, 225, 0.1);
      border-radius: 4px;
    }

    .stat-label {
      color: #b0b0b0;
    }

    .stat-value {
      color: #4dd0e1;
      font-weight: 600;
    }

    .inventory-preview {
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
    }

    .inventory-item {
      display: flex;
      justify-content: space-between;
      padding: 6px 10px;
      background: rgba(0, 0, 0, 0.3);
      margin: 4px 0;
      border-radius: 4px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <!-- Header -->
    <div class="test-header">
      <h1>üî® Crafting System Test</h1>
      <p>Complete testing environment for recipe-based crafting</p>
    </div>

    <!-- Control Panels -->
    <div class="control-panel">
      <!-- Crafting Control -->
      <div class="control-section">
        <h3>üî® Crafting Control</h3>
        <div class="button-group">
          <button onclick="openCrafting()" class="success">Open Crafting Menu (C)</button>
          <button onclick="closeCrafting()">Close Crafting</button>
        </div>
        <div class="info-display" id="craftingInfo">
          Press 'C' to toggle crafting menu<br>
          ESC to close
        </div>
      </div>

      <!-- Player Stats -->
      <div class="control-section">
        <h3>üìä Player Stats</h3>
        <div class="stat-grid">
          <div class="stat-item">
            <span class="stat-label">‚ö° Energy</span>
            <span class="stat-value" id="energyStat">100</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">üî® Crafting</span>
            <span class="stat-value" id="craftingSkill">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">üå≤ Woodcutting</span>
            <span class="stat-value" id="woodcuttingSkill">0</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">üèïÔ∏è Survival</span>
            <span class="stat-value" id="survivalSkill">0</span>
          </div>
        </div>
        <div class="button-group" style="margin-top: 10px;">
          <button onclick="boostSkills()">+10 All Skills</button>
          <button onclick="restoreEnergy()" class="success">Restore Energy</button>
        </div>
      </div>

      <!-- Quick Add Resources -->
      <div class="control-section">
        <h3>üì¶ Quick Add Resources</h3>
        <div class="button-group">
          <button onclick="addBasicResources()">Basic Resources</button>
          <button onclick="addAllMaterials()">All Materials</button>
          <button onclick="addTools()">Add Tools</button>
          <button onclick="clearInventory()" class="warning">Clear Inventory</button>
        </div>
        <div class="inventory-preview" id="inventoryPreview">
          <!-- Will be populated -->
        </div>
      </div>

      <!-- Recipe Testing -->
      <div class="control-section">
        <h3>üß™ Recipe Testing</h3>
        <div class="button-group">
          <button onclick="testBasicCrafting()">Test Basic Recipe</button>
          <button onclick="testQualityCrafting()">Test Quality System</button>
          <button onclick="testSkillRequirement()">Test Skill Check</button>
          <button onclick="unlockAllRecipes()">Unlock All Recipes</button>
        </div>
        <div class="info-display" id="testResults">
          Recipe testing results will appear here
        </div>
      </div>
    </div>
  </div>

  <!-- Load Modules -->
  <script type="module">
    import { Player } from '../src/modules/player.js';
    import { Inventory } from '../src/modules/inventory.js';
    import { itemDB } from '../src/data/itemDatabase.js';
    import { recipeDB } from '../src/modules/recipe.js';
    import { CraftingUI } from '../src/ui/craftingUI.js';

    // Initialize player
    const player = new Player({
      name: 'Test Crafter',
      gender: 'neutral'
    });

    // Give some starting skills
    player.skills.crafting = 10;
    player.skills.survival = 5;
    player.skills.woodcutting = 5;

    // Initialize crafting UI
    const craftingUI = new CraftingUI(player);

    // Make globally accessible
    window.player = player;
    window.craftingUI = craftingUI;
    window.itemDB = itemDB;
    window.recipeDB = recipeDB;

    // Update displays
    function updateDisplays() {
      // Stats
      document.getElementById('energyStat').textContent = Math.floor(player.stats.energy);
      document.getElementById('craftingSkill').textContent = Math.floor(player.skills.crafting);
      document.getElementById('woodcuttingSkill').textContent = Math.floor(player.skills.woodcutting);
      document.getElementById('survivalSkill').textContent = Math.floor(player.skills.survival);

      // Inventory preview
      const inventoryDiv = document.getElementById('inventoryPreview');
      const items = player.inventory.slots
        .filter(slot => !slot.isEmpty())
        .map(slot => `
          <div class="inventory-item">
            <span>${slot.item.name}</span>
            <span>√ó${slot.quantity}</span>
          </div>
        `).join('');
      
      inventoryDiv.innerHTML = items || '<div class="inventory-item">Empty</div>';
    }

    // Crafting controls
    window.openCrafting = function() {
      craftingUI.show();
      document.getElementById('craftingInfo').textContent = '‚úÖ Crafting menu open - Browse recipes and craft items!';
    };

    window.closeCrafting = function() {
      craftingUI.hide();
      document.getElementById('craftingInfo').textContent = 'Crafting menu closed';
    };

    // Player controls
    window.boostSkills = function() {
      player.skills.crafting += 10;
      player.skills.woodcutting += 10;
      player.skills.survival += 10;
      updateDisplays();
      document.getElementById('craftingInfo').textContent = '‚≠ê All skills +10';
    };

    window.restoreEnergy = function() {
      player.stats.energy = 100;
      updateDisplays();
      document.getElementById('craftingInfo').textContent = '‚ö° Energy restored';
    };

    // Resource management
    window.addBasicResources = function() {
      player.inventory.addItem(itemDB.get('wood'), 20);
      player.inventory.addItem(itemDB.get('stone'), 15);
      player.inventory.addItem(itemDB.get('fiber'), 25);
      updateDisplays();
      document.getElementById('craftingInfo').textContent = 'üì¶ Added basic resources (wood, stone, fiber)';
    };

    window.addAllMaterials = function() {
      player.inventory.addItem(itemDB.get('wood'), 50);
      player.inventory.addItem(itemDB.get('stone'), 50);
      player.inventory.addItem(itemDB.get('fiber'), 50);
      player.inventory.addItem(itemDB.get('leather'), 20);
      player.inventory.addItem(itemDB.get('metal_scrap'), 10);
      player.inventory.addItem(itemDB.get('rope'), 10);
      player.inventory.addItem(itemDB.get('cloth'), 10);
      updateDisplays();
      document.getElementById('craftingInfo').textContent = 'üì¶ Added all crafting materials';
    };

    window.addTools = function() {
      player.inventory.addItem(itemDB.get('stone_axe'), 1);
      player.inventory.addItem(itemDB.get('stone_pickaxe'), 1);
      player.inventory.addItem(itemDB.get('knife'), 1);
      updateDisplays();
      document.getElementById('craftingInfo').textContent = 'üîß Added basic tools';
    };

    window.clearInventory = function() {
      player.inventory.clear();
      updateDisplays();
      document.getElementById('craftingInfo').textContent = 'üóëÔ∏è Inventory cleared';
    };

    // Recipe testing
    window.testBasicCrafting = function() {
      // Add resources for stone axe
      player.inventory.addItem(itemDB.get('wood'), 3);
      player.inventory.addItem(itemDB.get('stone'), 2);
      player.inventory.addItem(itemDB.get('fiber'), 2);
      
      const recipe = recipeDB.get('stone_axe');
      const result = recipe.craft(player);
      
      const resultDiv = document.getElementById('testResults');
      if (result.success) {
        resultDiv.innerHTML = `
          ‚úÖ Successfully crafted Stone Axe<br>
          Quality: ${result.quality}<br>
          XP Gained: ${result.xpGained}
        `;
      } else {
        resultDiv.innerHTML = `‚ùå Failed: ${result.reason}`;
      }
      
      updateDisplays();
    };

    window.testQualityCrafting = function() {
      // Boost skill for better quality
      player.skills.crafting = 50;
      player.inventory.addItem(itemDB.get('wood'), 30);
      player.inventory.addItem(itemDB.get('stone'), 20);
      player.inventory.addItem(itemDB.get('fiber'), 20);
      
      // Craft multiple times to test quality distribution
      const results = { poor: 0, normal: 0, good: 0, excellent: 0 };
      
      for (let i = 0; i < 10; i++) {
        const recipe = recipeDB.get('stone_axe');
        const result = recipe.craft(player);
        if (result.success) {
          results[result.quality]++;
        }
      }
      
      const resultDiv = document.getElementById('testResults');
      resultDiv.innerHTML = `
        üé≤ Quality Distribution (10 crafts):<br>
        Poor: ${results.poor}<br>
        Normal: ${results.normal}<br>
        Good: ${results.good}<br>
        Excellent: ${results.excellent}<br>
        (Higher skill = better quality!)
      `;
      
      updateDisplays();
    };

    window.testSkillRequirement = function() {
      // Try to craft a bow (requires crafting 15)
      player.skills.crafting = 5; // Too low
      player.inventory.addItem(itemDB.get('wood'), 10);
      player.inventory.addItem(itemDB.get('fiber'), 20);
      
      const recipe = recipeDB.get('bow');
      const canCraft = recipe.canCraft(player);
      
      const resultDiv = document.getElementById('testResults');
      if (canCraft.success) {
        resultDiv.innerHTML = '‚úÖ Skill requirement met';
      } else {
        resultDiv.innerHTML = `
          ‚ùå Skill Check Failed<br>
          Reason: ${canCraft.reason}<br>
          <br>
          <button onclick="boostSkills(); boostSkills();">Boost Skills to Test</button>
        `;
      }
      
      updateDisplays();
    };

    window.unlockAllRecipes = function() {
      recipeDB.getAll().forEach(recipe => {
        recipe.unlocked = true;
      });
      document.getElementById('testResults').textContent = 'üîì All recipes unlocked!';
    };

    // Initial update
    updateDisplays();
    
    console.log('üî® Crafting Test Page Loaded');
    console.log('üìã Available recipes:', recipeDB.getAll().length);
    console.log('üí° Press C to open crafting menu');
    console.log('üí° Access globals: player, craftingUI, itemDB, recipeDB');
  </script>
</body>
</html>
